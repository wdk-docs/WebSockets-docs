<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WS API Document &mdash; WebSockets Docs v2022.1115 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="koa-easy-ws" href="koa-easy-ws.html" />
    <link rel="prev" title="ws: a Node.js WebSocket library" href="ws-quick-start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../contents.html" class="icon icon-home"> WebSockets Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../awesome.html">Awesome WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../socket.io/index.html">socket.io 文档</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ws 文档</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="koa-websocket.html">koa-websocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="ws-quick-start.html">ws: a Node.js WebSocket library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">WS API Document</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#class-websocketserver">Class: WebSocketServer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#WebSocket.Server"><code class="docutils literal notranslate"><span class="pre">WebSocket.Server</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#handleProtocols"><code class="docutils literal notranslate"><span class="pre">handleProtocols()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.close"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.connection"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.connection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.error"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.error()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.headers"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.headers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.listening"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.listening()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#server.address"><code class="docutils literal notranslate"><span class="pre">server.address()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#server.clients"><code class="docutils literal notranslate"><span class="pre">server.clients</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#server.close"><code class="docutils literal notranslate"><span class="pre">server.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#server.handleUpgrade"><code class="docutils literal notranslate"><span class="pre">server.handleUpgrade()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#server.shouldHandle"><code class="docutils literal notranslate"><span class="pre">server.shouldHandle()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#class-websocket">Class: WebSocket</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#WebSocket"><code class="docutils literal notranslate"><span class="pre">WebSocket</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id0"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.error()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.message"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.message()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.open"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.open()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.ping"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.ping()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.pong"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.pong()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.unexpected-response"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.unexpected-response()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ws.onEvent.upgrade"><code class="docutils literal notranslate"><span class="pre">ws.onEvent.upgrade()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.addEventListener"><code class="docutils literal notranslate"><span class="pre">websocket.addEventListener()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.binaryType"><code class="docutils literal notranslate"><span class="pre">websocket.binaryType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.bufferedAmount"><code class="docutils literal notranslate"><span class="pre">websocket.bufferedAmount</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.close"><code class="docutils literal notranslate"><span class="pre">websocket.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.extensions"><code class="docutils literal notranslate"><span class="pre">websocket.extensions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.onclose"><code class="docutils literal notranslate"><span class="pre">websocket.onclose()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.onerror"><code class="docutils literal notranslate"><span class="pre">websocket.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.onmessage"><code class="docutils literal notranslate"><span class="pre">websocket.onmessage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.onopen"><code class="docutils literal notranslate"><span class="pre">websocket.onopen()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.ping"><code class="docutils literal notranslate"><span class="pre">websocket.ping()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.pong"><code class="docutils literal notranslate"><span class="pre">websocket.pong()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.protocol"><code class="docutils literal notranslate"><span class="pre">websocket.protocol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.readyState"><code class="docutils literal notranslate"><span class="pre">websocket.readyState</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.removeEventListener"><code class="docutils literal notranslate"><span class="pre">websocket.removeEventListener()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.send"><code class="docutils literal notranslate"><span class="pre">websocket.send()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.terminate"><code class="docutils literal notranslate"><span class="pre">websocket.terminate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#websocket.url"><code class="docutils literal notranslate"><span class="pre">websocket.url</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#createwebsocketstream-websocket-options">createWebSocketStream(websocket[, options])</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#createWebSocketStream"><code class="docutils literal notranslate"><span class="pre">createWebSocketStream()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ws-error-codes">WS错误码</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_EXPECTED_FIN"><code class="docutils literal notranslate"><span class="pre">WS_ERR_EXPECTED_FIN</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_EXPECTED_MASK"><code class="docutils literal notranslate"><span class="pre">WS_ERR_EXPECTED_MASK</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_INVALID_CLOSE_CODE"><code class="docutils literal notranslate"><span class="pre">WS_ERR_INVALID_CLOSE_CODE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"><code class="docutils literal notranslate"><span class="pre">WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_INVALID_OPCODE"><code class="docutils literal notranslate"><span class="pre">WS_ERR_INVALID_OPCODE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_INVALID_UTF8"><code class="docutils literal notranslate"><span class="pre">WS_ERR_INVALID_UTF8</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_UNEXPECTED_MASK"><code class="docutils literal notranslate"><span class="pre">WS_ERR_UNEXPECTED_MASK</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_UNEXPECTED_RSV_1"><code class="docutils literal notranslate"><span class="pre">WS_ERR_UNEXPECTED_RSV_1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_UNEXPECTED_RSV_2_3"><code class="docutils literal notranslate"><span class="pre">WS_ERR_UNEXPECTED_RSV_2_3</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"><code class="docutils literal notranslate"><span class="pre">WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"><code class="docutils literal notranslate"><span class="pre">WS_ERR_UNSUPPORTED_MESSAGE_LENGTH</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="koa-easy-ws.html">koa-easy-ws</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi-room.html">基于 ws.js 的 Websocket 多房间</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blogs/index.html">博客</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">WebSockets Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../contents.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">ws 文档</a></li>
      <li class="breadcrumb-item active">WS API Document</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ws/ws-api.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ws-api-document">
<h1>WS API Document<a class="headerlink" href="#ws-api-document" title="此标题的永久链接"></a></h1>
<section id="class-websocketserver">
<h2>Class: WebSocketServer<a class="headerlink" href="#class-websocketserver" title="此标题的永久链接"></a></h2>
<dl class="js class">
<dt class="sig sig-object js" id="WebSocket.Server">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="n"><span class="pre">WebSocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">Server</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">{host</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noServer...}</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#WebSocket.Server" title="永久链接至目标"></a></dt>
<dd><p>本类代表一个WebSocket服务。它扩展自 <cite>EventEmitter</cite></p>
<p>new WebSocket.Server(options[, callback])</p>
<p>Create a new server instance. One of <cite>port</cite>, <cite>server</cite> or <cite>noServer</cite> must be provided or an error is thrown.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>host</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – The hostname where to bind the server.</p></li>
<li><p><strong>port</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The port where to bind the server.</p></li>
<li><p><strong>backlog</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum length of the queue of pending connections.</p></li>
<li><p><strong>server</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.Server</span> <span class="pre">|</span> <span class="pre">https.Server()</span></code></span>) – A pre-created Node.js HTTP/S server.</p></li>
<li><p><strong>verifyClient</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – 一个用来验证接入有效性的函数。详情如下：</p></li>
<li><p><strong>handleProtocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – A function which can be used to handle the WebSocket subprotocols. See description below.</p></li>
<li><p><strong>path</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – Accept only connections matching this path.</p></li>
<li><p><strong>noServer</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Enable no server mode.</p></li>
<li><p><strong>clientTracking</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether or not to track clients.</p></li>
<li><p><strong>perMessageDeflate</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean</span> <span class="pre">|</span> <span class="pre">Object()</span></code></span>) – <p>Enable/disable permessage-deflate.</p>
<p><cite>perMessageDeflate</cite> can be used to control the behavior of <a class="reference external" href="permessage-deflate">permessage-deflate extension</a>.
he extension is disabled when <cite>false</cite> (default value).</p>
<p>If an object is provided then that is extension parameters:</p>
<blockquote>
<div><ul>
<li><p><strong>serverNoContextTakeover</strong>: (<em>Boolean</em>) - Whether to use context takeover or not.</p></li>
<li><p><strong>clientNoContextTakeover</strong>: (<em>Boolean</em>) - Acknowledge disabling of client context takeover.</p></li>
<li><p><strong>serverMaxWindowBits</strong>: (<em>Number</em>) - The value of <cite>windowBits</cite>.</p></li>
<li><p><strong>clientMaxWindowBits</strong>: (<em>Number</em>) - Request a custom client window size.</p></li>
<li><p><strong>zlibDeflateOptions</strong>: (<em>Object</em>) - Additional options &lt;zlib-options&gt;`_ to pass to zlib on deflate.</p></li>
<li><p><strong>zlibInflateOptions</strong>: (<em>Object</em>) - Additional options &lt;zlib-options&gt;`_ to pass to zlib on inflate.</p></li>
<li><p><strong>threshold</strong>: (<em>Number</em>) - Payloads smaller than this will not be compressed. Defaults to 1024 bytes.</p></li>
<li><p><strong>concurrencyLimit</strong>: (<em>Number</em>) - The number of concurrent calls to zlib. Calls above this limit will be queued. Default 10. You usually won’t need to touch this option. See <a class="reference external" href="concurrency-limit">this issue</a> for more details.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>maxPayload</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum allowed message size in bytes.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – <cite>callback</cite> will be added as a listener for the <cite>listening</cite> event on the HTTP server when not operating in “noServer” mode.</p></li>
</ul>
</dd>
</dl>
<p>An HTTP server is automatically created, started, and used if <cite>port</cite> is set.</p>
<p>To use an external HTTP/S server instead, specify only <cite>server</cite> or <cite>noServer</cite>.
In this case the HTTP/S server must be started manually. The “noServer” mode allows the WebSocket server to be completly detached from the HTTP/S server.
This makes it possible, for example, to share a single HTTP/S server between multiple WebSocket servers.</p>
<p>If <cite>verifyClient</cite> is not set then the handshake is automatically accepted.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="handleProtocols">
<span class="sig-name descname"><span class="n"><span class="pre">handleProtocols</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">protocols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#handleProtocols" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>protocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Array()</span></code></span>) – The list of WebSocket subprotocols indicated by the client in the <cite>Sec-WebSocket-Protocol</cite> header.</p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
</ul>
</dd>
</dl>
<p>The returned value sets the value of the <cite>Sec-WebSocket-Protocol</cite> header in the HTTP 101 response.</p>
<p>If returned value is <cite>false</cite> the header is not added in the response.</p>
<p>If <cite>handleProtocols</cite> is not set then the first of the client’s requested subprotocols is used.</p>
</dd></dl>

<p>If a property is empty then either an offered configuration or a default value is used. When sending a fragmented message the length of the first fragment is compared to the threshold.</p>
<p>This determines if compression is used for the entire message.</p>
<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.close">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">close</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.close" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the server closes. This event depends on the <cite>‘close’</cite> event of HTTP server only when it is created internally.</p>
<p>In all other cases, the event is emitted independently.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.connection">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">connection</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">socket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.connection" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the handshake is complete.</p>
<p>Useful for parsing authority headers, cookie headers, and other information.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>socket</strong> (<span><a class="reference internal" href="#WebSocket" title="WebSocket"><code class="xref js js-func docutils literal notranslate"><span class="pre">WebSocket()</span></code></a></span>) – </p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – the http GET request sent by the client.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.error">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">error</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.error" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>error</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Error()</span></code></span>) – Emitted when an error occurs on the underlying server.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.headers">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">headers</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">headers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">request</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.headers" title="永久链接至目标"></a></dt>
<dd><p>Emitted before the response headers are written to the socket as part of the handshake.</p>
<p>This allows you to inspect/modify the headers before they are sent.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>headers</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Array()</span></code></span>) – </p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.listening">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">listening</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.listening" title="永久链接至目标"></a></dt>
<dd><p>当底层服务器被绑定时发出。</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="server.address">
<span class="sig-prename descclassname"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">address</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#server.address" title="永久链接至目标"></a></dt>
<dd><p>Returns an object with <cite>port</cite>, <cite>family</cite>, and <cite>address</cite> properties specifying the bound address, the address family name,
and port of the server as reported by the operating system if listening on an IP socket.</p>
<p>If the server is listening on a pipe or UNIX domain socket, the name is returned as a string.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="server.clients">
<span class="sig-prename descclassname"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">clients</span></span></span><a class="headerlink" href="#server.clients" title="永久链接至目标"></a></dt>
<dd><p>Please note that this property is only added when the <cite>clientTracking</cite> is truthy.</p>
<dl class="field-list simple">
<dt class="field-odd">Return</dt>
<dd class="field-odd"><p>A set that stores all connected clients.</p>
</dd>
<dt class="field-even">Rtype</dt>
<dd class="field-even"><p>Set</p>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="server.close">
<span class="sig-prename descclassname"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">close</span></span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#server.close" title="永久链接至目标"></a></dt>
<dd><p>Close the HTTP server if created internally, terminate all clients and call callback when done.</p>
<p>If an external HTTP server is used via the <cite>server</cite> or <cite>noServer</cite> constructor options, it must be closed manually.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="server.handleUpgrade">
<span class="sig-prename descclassname"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">handleUpgrade</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">socket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#server.handleUpgrade" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
<li><p><strong>socket</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">net.Socket()</span></code></span>) – The network socket between the server and client.</p></li>
<li><p><strong>head</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Buffer()</span></code></span>) – The first packet of the upgraded stream.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function(WebSocket)()</span></code></span>) – If the upgrade is successful, the <cite>callback</cite> is called with a <cite>WebSocket</cite> object as parameter.</p></li>
</ul>
</dd>
</dl>
<p>Handle a HTTP upgrade request.
When the HTTP server is created internally or when the HTTP server is passed via the <cite>server</cite> option, this method is called automatically.</p>
<p>When operating in “noServer” mode, this method must be called manually.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="server.shouldHandle">
<span class="sig-prename descclassname"><span class="n"><span class="pre">server</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">shouldHandle</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#server.shouldHandle" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
</ul>
</dd>
</dl>
<p>See if a given request should be handled by this server.</p>
<p>By default this method validates the pathname of the request, matching it against the <cite>path</cite> option if provided.</p>
<p>The return value, <cite>true</cite> or <cite>false</cite>, determines whether or not to accept the handshake.</p>
<p>This method can be overridden when a custom handling logic is required.</p>
</dd></dl>

</section>
<section id="class-websocket">
<h2>Class: WebSocket<a class="headerlink" href="#class-websocket" title="此标题的永久链接"></a></h2>
<p>This class represents a WebSocket. It extends the <cite>EventEmitter</cite>.</p>
<p>准备好的状态常量</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 10%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>常量</p></th>
<th class="head"><p>值</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CONNECTING</p></td>
<td><p>0</p></td>
<td><p>连接未打开</p></td>
</tr>
<tr class="row-odd"><td><p>OPEN</p></td>
<td><p>1</p></td>
<td><p>连接已打开并准备交流</p></td>
</tr>
<tr class="row-even"><td><p>CLOSING</p></td>
<td><p>2</p></td>
<td><p>连接关闭中</p></td>
</tr>
<tr class="row-odd"><td><p>CLOSED</p></td>
<td><p>3</p></td>
<td><p>连接已关闭</p></td>
</tr>
</tbody>
</table>
<dl class="js class">
<dt class="sig sig-object js" id="WebSocket">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">WebSocket</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">address[,</span> <span class="pre">protocols][,</span> <span class="pre">{followRedirects,...}]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#WebSocket" title="永久链接至目标"></a></dt>
<dd><p>new WebSocket(address[, protocols][, options])</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String</span> <span class="pre">|</span> <span class="pre">url.URL()</span></code></span>) – 连接用的URL</p></li>
<li><p><strong>protocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String</span> <span class="pre">|</span> <span class="pre">Array()</span></code></span>) – The list of subprotocols.</p></li>
<li><p><strong>followRedirects</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Whether or not to follow redirects. Defaults to <cite>false</cite>.</p></li>
<li><p><strong>handshakeTimeout</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – Timeout in milliseconds for the handshake request. This is reset after every redirection.</p></li>
<li><p><strong>maxPayload</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum allowed message size in bytes.</p></li>
<li><p><strong>maxRedirects</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum number of redirects allowed. Defaults to 10.</p></li>
<li><p><strong>origin</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – Value of the <cite>Origin</cite> or <cite>Sec-WebSocket-Origin</cite> header depending on the <cite>protocolVersion</cite>.</p></li>
<li><p><strong>perMessageDeflate</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean(true)</span> <span class="pre">|</span> <span class="pre">Object()</span></code></span>) – Enable/disable permessage-deflate. <cite>perMessageDeflate</cite> default value is <cite>true</cite>. When using an object, parameters are the same of the server.The only difference is the direction of requests. For example, serverNoContextTakeover can be used to ask the server to disable context takeover.</p></li>
<li><p><strong>protocolVersion</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – Value of the <cite>Sec-WebSocket-Version</cite> header.</p></li>
<li><p><strong>skipUTF8Validation</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether or not to skip UTF-8 validation for text and close messages. Defaults to false. Set to true only if the server is trusted.</p></li>
<li><p><strong>other</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Any</span> <span class="pre">other</span> <span class="pre">option</span> <span class="pre">allowed</span> <span class="pre">in</span> <span class="pre">http.request()</span> <span class="pre">or</span> <span class="pre">https.request()</span></code></span>) – Options given do not have any effect if parsed from the URL given with the address parameter.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>Create a new WebSocket instance.</p>
<p><strong>UNIX Domain Sockets</strong></p>
<p><cite>ws</cite> supports making requests to UNIX domain sockets. To make one, use the following URL scheme:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ws+unix:///absolute/path/to/uds_socket:/pathname?search_params
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>that <cite>:</cite> is the separator between the socket path and the URL path. If the URL path is omitted</p>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ws+unix:///absolute/path/to/uds_socket
</pre></div>
</div>
<p>it defaults to <cite>/</cite>.</p>
<dl class="js method">
<dt class="sig sig-object js" id="id0">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">close</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the connection is closed.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – a numeric value indicating the status code explaining why the connection has been closed.</p></li>
<li><p><strong>reason</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – a human-readable string explaining why the connection has been closed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="id1">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">error</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id1" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>error</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Error()</span></code></span>) – Emitted when an error occurs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="ws.onEvent.message">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">message</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.message" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String|Buffer|ArrayBuffer|Buffer[]()</span></code></span>) – Emitted when a message is received from the server.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="ws.onEvent.open">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">open</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.open" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the connection is established.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="ws.onEvent.ping">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">ping</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.ping" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Buffer()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Emitted when a ping is received from the server.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="ws.onEvent.pong">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">pong</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.pong" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Buffer()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Emitted when a pong is received from the server.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="ws.onEvent.unexpected-response">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">unexpected-response</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.unexpected-response" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.ClientRequest()</span></code></span>) – </p></li>
<li><p><strong>response</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Emitted when the server response is not the expected one, for example a 401 response.</p>
<p>This event gives the ability to read the response in order to extract useful information.</p>
<p>If the server sends an invalid response and there isn’t a listener for this event, an error is emitted.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="ws.onEvent.upgrade">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ws</span></span><span class="p"><span class="pre">.</span></span><span class="n"><span class="pre">onEvent</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">upgrade</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.upgrade" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>response</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Emitted when response headers are received from the server as part of the handshake.</p>
<p>This allows you to read headers from the server, for example ‘set-cookie’ headers.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.addEventListener">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">addEventListener</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">listener</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.addEventListener" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – A string representing the event type to listen for.</p></li>
<li><p><strong>listener</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – The listener to add.</p></li>
</ul>
</dd>
</dl>
<p>Register an event listener emulating the <cite>EventTarget</cite> interface.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="websocket.binaryType">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">binaryType</span></span></span><a class="headerlink" href="#websocket.binaryType" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return</dt>
<dd class="field-odd"><p>A string indicating the type of binary data being transmitted by the connection.</p>
</dd>
<dt class="field-even">Rtype</dt>
<dd class="field-even"><p>String</p>
</dd>
</dl>
<p>This should be one of “nodebuffer”, “arraybuffer” or “fragments”.</p>
<p>Defaults to “nodebuffer”.</p>
<p>Type “fragments” will emit the array of fragments as received from the sender,
without copyfull concatenation,
which is useful for the performance of binary protocols transferring large messages with multiple fragments.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="websocket.bufferedAmount">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">bufferedAmount</span></span></span><a class="headerlink" href="#websocket.bufferedAmount" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return</dt>
<dd class="field-odd"><p>The number of bytes of data that have been queued using calls to <cite>send()</cite> but not yet transmitted to the network.</p>
</dd>
<dt class="field-even">Rtype</dt>
<dd class="field-even"><p>Number</p>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.close">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">close</span></span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">reason</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.close" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> – Number} A numeric value indicating the status code explaining why the connection is being closed.</p></li>
<li><p><strong>reason</strong> – String} A human-readable string explaining why the connection is closing.</p></li>
</ul>
</dd>
</dl>
<p>Initiate a closing handshake.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="websocket.extensions">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">extensions</span></span></span><a class="headerlink" href="#websocket.extensions" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Rtype</dt>
<dd class="field-odd"><p>Object</p>
</dd>
<dt class="field-even">Return</dt>
<dd class="field-even"><p>包含协商扩展的对象。</p>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.onclose">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">onclose</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onclose" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">返回类型</dt>
<dd class="field-odd"><p>Function</p>
</dd>
<dt class="field-even">返回</dt>
<dd class="field-even"><p>当连接关闭时调用事件监听器</p>
</dd>
</dl>
<p>The listener receives a <cite>CloseEvent</cite> named “close”.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.onerror">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">onerror</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onerror" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">返回类型</dt>
<dd class="field-odd"><p>Function</p>
</dd>
<dt class="field-even">返回</dt>
<dd class="field-even"><p>发生错误时调用的事件</p>
</dd>
</dl>
<p>The listener receives an <cite>ErrorEvent</cite> named “error”.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.onmessage">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">onmessage</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onmessage" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">返回类型</dt>
<dd class="field-odd"><p>Function</p>
</dd>
<dt class="field-even">返回</dt>
<dd class="field-even"><p>An event listener to be called when a message is received from the server.</p>
</dd>
</dl>
<p>The listener receives a <cite>MessageEvent</cite> named “message”.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.onopen">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">onopen</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onopen" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">返回类型</dt>
<dd class="field-odd"><p>Function</p>
</dd>
<dt class="field-even">返回</dt>
<dd class="field-even"><p>An event listener to be called when the connection is established.</p>
</dd>
</dl>
<p>The listener receives an <cite>OpenEvent</cite> named “open”.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.ping">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">ping</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">[data[,</span> <span class="pre">mask]][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.ping" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Any()</span></code></span>) – 在ping结构中发送的数据</p></li>
<li><p><strong>mask</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – An optional callback which is invoked when the ping frame is written out.</p></li>
</ul>
</dd>
</dl>
<p>发送一个ping</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.pong">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">pong</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">[data[,</span> <span class="pre">mask]][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.pong" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Any()</span></code></span>) – 在pong结构中发送的数据</p></li>
<li><p><strong>mask</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – An optional callback which is invoked when the pong frame is written out.</p></li>
</ul>
</dd>
</dl>
<p>发送一个pong</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="websocket.protocol">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">protocol</span></span></span><a class="headerlink" href="#websocket.protocol" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return</dt>
<dd class="field-odd"><p>服务器选择的subprotocal</p>
</dd>
<dt class="field-even">Rtype</dt>
<dd class="field-even"><p>String</p>
</dd>
</dl>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="websocket.readyState">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">readyState</span></span></span><a class="headerlink" href="#websocket.readyState" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Rtype</dt>
<dd class="field-odd"><p>Number</p>
</dd>
<dt class="field-even">Return</dt>
<dd class="field-even"><p>当前链接状态。预备状态常量的一个。</p>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.removeEventListener">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">removeEventListener</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">listener</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.removeEventListener" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – 要删除的表示事件类型的字符</p></li>
<li><p><strong>listener</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – 要删除的监听器</p></li>
</ul>
</dd>
</dl>
<p>Removes an event listener emulating the <cite>EventTarget</cite> interface.</p>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.send">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">send</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data[,</span> <span class="pre">options][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.send" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Any()</span></code></span>) – 发送的数据</p></li>
<li><p><strong>options</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Object()</span></code></span>) – </p></li>
<li><p><strong>compress</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether <cite>data</cite> should be compressed or not.Defaults to <cite>true</cite> when permessage-deflate is enabled.</p></li>
<li><p><strong>binary</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether <cite>data</cite> should be sent as a binary or not. Default is autodetected.</p></li>
<li><p><strong>mask</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p><strong>fin</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether <cite>data</cite> is the last fragment of a message or not. Defaults to <cite>true</cite>.</p></li>
<li><p><strong>callback</strong> – <p>Function An optional callback which is invoked when <cite>data</cite> is written out.</p>
<p>通过连接发送 <cite>data</cite></p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js method">
<dt class="sig sig-object js" id="websocket.terminate">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">terminate</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.terminate" title="永久链接至目标"></a></dt>
<dd><p>强制关闭连接</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="websocket.url">
<span class="sig-prename descclassname"><span class="n"><span class="pre">websocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">url</span></span></span><a class="headerlink" href="#websocket.url" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Rtype</dt>
<dd class="field-odd"><p>String</p>
</dd>
<dt class="field-even">Return</dt>
<dd class="field-even"><p>WebSocket 服务器的 URL。服务器客户端没有这个属性。</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="createwebsocketstream-websocket-options">
<h2>createWebSocketStream(websocket[, options])<a class="headerlink" href="#createwebsocketstream-websocket-options" title="此标题的永久链接"></a></h2>
<dl class="js function">
<dt class="sig sig-object js" id="createWebSocketStream">
<span class="sig-name descname"><span class="n"><span class="pre">createWebSocketStream</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">websocket</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">options</span></span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#createWebSocketStream" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>websocket</strong> (<span><a class="reference internal" href="#WebSocket" title="WebSocket"><code class="xref js js-func docutils literal notranslate"><span class="pre">WebSocket()</span></code></a></span>) – 一个对象</p></li>
<li><p><strong>options</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Object()</span></code></span>) – 通过双工构建传输选项</p></li>
</ul>
</dd>
<dt class="field-even">返回</dt>
<dd class="field-even"><p>返回一个双攻流允许在给定的WebSocket之上使用Node.js流接口</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="ws-error-codes">
<h2>WS错误码<a class="headerlink" href="#ws-error-codes" title="此标题的永久链接"></a></h2>
<p>Errors emitted by the websocket may have a <cite>.code</cite> property, describing the specific type of error that has occurred:</p>
<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_EXPECTED_FIN">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_EXPECTED_FIN</span></span></span><a class="headerlink" href="#WS_ERR_EXPECTED_FIN" title="永久链接至目标"></a></dt>
<dd><p>A WebSocket frame was received with the FIN bit not set when it was expected.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_EXPECTED_MASK">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_EXPECTED_MASK</span></span></span><a class="headerlink" href="#WS_ERR_EXPECTED_MASK" title="永久链接至目标"></a></dt>
<dd><p>An unmasked WebSocket frame was received by a WebSocket server.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_INVALID_CLOSE_CODE">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_INVALID_CLOSE_CODE</span></span></span><a class="headerlink" href="#WS_ERR_INVALID_CLOSE_CODE" title="永久链接至目标"></a></dt>
<dd><p>A WebSocket close frame was received with an invalid close code.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH</span></span></span><a class="headerlink" href="#WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH" title="永久链接至目标"></a></dt>
<dd><p>A control frame with an invalid payload length was received.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_INVALID_OPCODE">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_INVALID_OPCODE</span></span></span><a class="headerlink" href="#WS_ERR_INVALID_OPCODE" title="永久链接至目标"></a></dt>
<dd><p>A WebSocket frame was received with an invalid opcode.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_INVALID_UTF8">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_INVALID_UTF8</span></span></span><a class="headerlink" href="#WS_ERR_INVALID_UTF8" title="永久链接至目标"></a></dt>
<dd><p>A text or close frame was received containing invalid UTF-8 data.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_UNEXPECTED_MASK">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_UNEXPECTED_MASK</span></span></span><a class="headerlink" href="#WS_ERR_UNEXPECTED_MASK" title="永久链接至目标"></a></dt>
<dd><p>A masked WebSocket frame was received by a WebSocket client.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_UNEXPECTED_RSV_1">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_UNEXPECTED_RSV_1</span></span></span><a class="headerlink" href="#WS_ERR_UNEXPECTED_RSV_1" title="永久链接至目标"></a></dt>
<dd><p>A WebSocket frame was received with the RSV1 bit set unexpectedly.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_UNEXPECTED_RSV_2_3">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_UNEXPECTED_RSV_2_3</span></span></span><a class="headerlink" href="#WS_ERR_UNEXPECTED_RSV_2_3" title="永久链接至目标"></a></dt>
<dd><p>A WebSocket frame was received with the RSV2 or RSV3 bit set unexpectedly.</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH</span></span></span><a class="headerlink" href="#WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH" title="永久链接至目标"></a></dt>
<dd><p>A data frame was received with a length longer than the max supported length (2^53 - 1, due to JavaScript language limitations).</p>
</dd></dl>

<dl class="js data">
<dt class="sig sig-object js" id="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH">
<span class="sig-name descname"><span class="n"><span class="pre">WS_ERR_UNSUPPORTED_MESSAGE_LENGTH</span></span></span><a class="headerlink" href="#WS_ERR_UNSUPPORTED_MESSAGE_LENGTH" title="永久链接至目标"></a></dt>
<dd></dd></dl>

<p>A message was received with a length longer than the maximum supported length, as configured by the maxPayload option.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="ws-quick-start.html" class="btn btn-neutral float-left" title="ws: a Node.js WebSocket library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="koa-easy-ws.html" class="btn btn-neutral float-right" title="koa-easy-ws" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2019-2022, BandCap.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>