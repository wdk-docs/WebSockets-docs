<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ws &mdash; WebSockets Docs v2019.0613 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="prev" title="ws: a Node.js WebSocket library" href="quick-start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../contents.html" class="icon icon-home"> WebSockets Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API documention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../awesome.html">令人敬畏的WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../socket.io/index.html">socket.io 文档</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ws documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="koa-websocket.html">koa-websocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html">ws: a Node.js WebSocket library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ws</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">WebSockets Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../contents.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">ws documentation</a> &raquo;</li>
      <li>ws</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ws/ws.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ws">
<h1>ws<a class="headerlink" href="#ws" title="永久链接至标题"></a></h1>
<dl class="js class">
<dt class="sig sig-object js" id="WebSocket.Server">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">WebSocket.</span></span><span class="sig-name descname"><span class="pre">Server</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">{host</span></em>, <em class="sig-param"><span class="pre">port</span></em>, <em class="sig-param"><span class="pre">server</span></em>, <em class="sig-param"><span class="pre">noServer...}</span></em><span class="optional">[</span>, <em class="sig-param"><span class="pre">callback</span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#WebSocket.Server" title="永久链接至目标"></a></dt>
<dd><p>此类表示WebSocket服务器。它扩展了 <cite>EventEmitter</cite> 。</p>
<p>new WebSocket.Server(options[, callback])</p>
<p>创建一个新的服务器实例。必须提供 <cite>port</cite>,  <cite>server</cite> 或 <cite>noServer</cite> 之一或抛出错误。</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>host</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – 主机名绑定服务器的位置。</p></li>
<li><p><strong>port</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – 绑定服务器的端口。</p></li>
<li><p><strong>backlog</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – 挂起连接队列的最大长度。</p></li>
<li><p><strong>server</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.Server</span> <span class="pre">|</span> <span class="pre">https.Server()</span></code></span>) – 预先创建的 Node.js HTTP/S 服务器。</p></li>
<li><p><strong>verifyClient</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – 一种可用于验证传入连接的功能。见下面的描述。</p></li>
<li><p><strong>handleProtocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – 一种可用于处理WebSocket子协议的函数。见下面的描述。</p></li>
<li><p><strong>path</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – 仅接受与此路径匹配的连接。</p></li>
<li><p><strong>noServer</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – 不启用服务器模式。</p></li>
<li><p><strong>clientTracking</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – 指定是否跟踪客户端。</p></li>
<li><p><strong>perMessageDeflate</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean</span> <span class="pre">|</span> <span class="pre">Object()</span></code></span>) – <p>启用/禁用渗透 - 放气。</p>
<p><cite>perMessageDeflate</cite> can be used to control the behavior of <a class="reference external" href="permessage-deflate">permessage-deflate extension</a>.
he extension is disabled when <cite>false</cite> (default value).</p>
<p>如果提供了一个对象, 那么这就是扩展参数:</p>
<blockquote>
<div><ul>
<li><p><strong>serverNoContextTakeover</strong>: (<em>Boolean</em>) - Whether to use context takeover or not.</p></li>
<li><p><strong>clientNoContextTakeover</strong>: (<em>Boolean</em>) - Acknowledge disabling of client context takeover.</p></li>
<li><p><strong>serverMaxWindowBits</strong>: (<em>Number</em>) - The value of <cite>windowBits</cite>.</p></li>
<li><p><strong>clientMaxWindowBits</strong>: (<em>Number</em>) - Request a custom client window size.</p></li>
<li><p><strong>zlibDeflateOptions</strong>: (<em>Object</em>) - Additional options &lt;zlib-options&gt;`_ to pass to zlib on deflate.</p></li>
<li><p><strong>zlibInflateOptions</strong>: (<em>Object</em>) - Additional options &lt;zlib-options&gt;`_ to pass to zlib on inflate.</p></li>
<li><p><strong>threshold</strong>: (<em>Number</em>) - Payloads smaller than this will not be compressed. Defaults to 1024 bytes.</p></li>
<li><p><strong>concurrencyLimit</strong>: (<em>Number</em>) - The number of concurrent calls to zlib. Calls above this limit will be queued. Default 10. You usually won’t need to touch this option. See <a class="reference external" href="concurrency-limit">this issue</a> for more details.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>maxPayload</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – <cite>maxPayload</cite> 允许的最大邮件大小（字节）。</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – 当不在 “noServer” 模式下运行时, <cite>callback</cite> 将被添加为HTTP服务器上 <cite>listening</cite> 事件的监听器。</p></li>
</ul>
</dd>
</dl>
<p>如果设置了 <cite>port</cite> , 则会自动创建, 启动和使用HTTP服务器。</p>
<p>To use an external HTTP/S server instead, specify only <cite>server</cite> or <cite>noServer</cite>.
In this case the HTTP/S server must be started manually. The “noServer” mode allows the WebSocket server to be completly detached from the HTTP/S server.
This makes it possible, for example, to share a single HTTP/S server between multiple WebSocket servers.</p>
<p>如果未设置 <cite>verifyClient</cite>, 则自动接受握手。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="verifyClient">
<span class="sig-name descname"><span class="pre">verifyClient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">{origin</span></em>, <em class="sig-param"><span class="pre">req</span></em>, <em class="sig-param"><span class="pre">secure}</span></em><span class="optional">[</span>, <em class="sig-param"><span class="pre">cb</span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#verifyClient" title="永久链接至目标"></a></dt>
<dd><p>如果它提供了单个参数, 那么就是:</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>origin</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – The value in the Origin header indicated by the client.</p></li>
<li><p><strong>req</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
<li><p><strong>secure</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – <cite>true</cite> if <cite>req.connection.authorized</cite> or <cite>req.connection.encrypted</cite> is set.</p></li>
</ul>
</dd>
</dl>
<p>函数的返回值（布尔值）确定是否接受握手。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="verifyClient.cb">
<span class="sig-prename descclassname"><span class="pre">verifyClient.</span></span><span class="sig-name descname"><span class="pre">cb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">result</span></em>, <em class="sig-param"><span class="pre">code</span></em>, <em class="sig-param"><span class="pre">name</span></em>, <em class="sig-param"><span class="pre">headers</span></em><span class="sig-paren">)</span><a class="headerlink" href="#verifyClient.cb" title="永久链接至目标"></a></dt>
<dd><p>如果`verifyClient`提供了两个参数, 那么它们就是:</p>
<p>A callback that must be called by the user upon inspection of the <cite>info</cite> fields.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>result</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Whether or not to accept the handshake.</p></li>
<li><p><strong>code</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – When <cite>result</cite> is <cite>false</cite> this field determines the HTTP error status code to be sent to the client.</p></li>
<li><p><strong>name</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – When <cite>result</cite> is <cite>false</cite> this field determines the HTTP reason phrase.</p></li>
<li><p><strong>headers</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Object()</span></code></span>) – When <cite>result</cite> is <cite>false</cite> this field determines additional HTTP headers to be sent to the client. For example, <cite>{ ‘Retry-After’: 120 }</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="handleProtocols">
<span class="sig-name descname"><span class="pre">handleProtocols</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">protocols</span></em>, <em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#handleProtocols" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>protocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Array()</span></code></span>) – The list of WebSocket subprotocols indicated by the client in the <cite>Sec-WebSocket-Protocol</cite> header.</p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
</ul>
</dd>
</dl>
<p>返回值设置HTTP 101响应中的`Sec-WebSocket-Protocol`头的值。</p>
<p>如果返回值为“false”, 则不在响应中添加标头。</p>
<p>如果未设置 <cite>handleProtocols</cite>, 则使用客户端请求的第一个子协议。</p>
</dd></dl>

<p>If a property is empty then either an offered configuration or a default value is used. When sending a fragmented message the length of the first fragment is compared to the threshold.</p>
<p>这确定是否对整个消息使用压缩。</p>
<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.close">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.close" title="永久链接至目标"></a></dt>
<dd><p>服务器关闭时发出。此事件仅在内部创建时依赖于HTTP服务器的“close”事件。</p>
<p>在所有其他情况下, 事件是独立发出的。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.connection">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">connection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">socket</span></em>, <em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.connection" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>socket</strong> (<span><a class="reference internal" href="../api/WebSocket.html#id0" title="WebSocket"><code class="xref js js-func docutils literal notranslate"><span class="pre">WebSocket()</span></code></a></span>) – </p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>握手完成时发出。 <a href="#id1"><span class="problematic" id="id2">`</span></a>request`是客户端发送的http GET请求。</p>
<p>用于解析权限标头, cookie标头和其他信息。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.error">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">error</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.error" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>error: Error</p></li>
</ul>
<p>在底层服务器上发生错误时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.headers">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">headers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">headers</span></em>, <em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.headers" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>headers</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Array()</span></code></span>) – </p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>在响应标头作为握手的一部分写入套接字之前发出。</p>
<p>这允许您在发送标头之前检查/修改标头。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.listening">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">listening</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.listening" title="永久链接至目标"></a></dt>
<dd><p>绑定基础服务器时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.address">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">address</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#server.address" title="永久链接至目标"></a></dt>
<dd><p>Returns an object with <cite>port</cite>, <cite>family</cite>, and <cite>address</cite> properties specifying the bound address, the address family name, and port of the server as reported by the operating system if listening on an IP socket.</p>
<p>如果服务器正在侦听管道或UNIX域套接字, 则该名称将作为字符串返回。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.clients">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">clients</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#server.clients" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Set}</p></li>
</ul>
<p>存储所有连接客户端的集合。请注意, 只有当`clientTracking`真实时, 才会添加此属性。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.close">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="pre">callback</span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#server.close" title="永久链接至目标"></a></dt>
<dd><p>如果在内部创建, 则关闭HTTP服务器, 终止所有客户端并在完成后调用回调。</p>
<p>如果通过`server`或`noServer`构造函数选项使用外部HTTP服务器, 则必须手动关闭它。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.handleUpgrade">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">handleUpgrade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">request</span></em>, <em class="sig-param"><span class="pre">socket</span></em>, <em class="sig-param"><span class="pre">head</span></em>, <em class="sig-param"><span class="pre">callback</span></em><span class="sig-paren">)</span><a class="headerlink" href="#server.handleUpgrade" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
<li><p><strong>socket</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">net.Socket()</span></code></span>) – The network socket between the server and client.</p></li>
<li><p><strong>head</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Buffer()</span></code></span>) – The first packet of the upgraded stream.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>处理HTTP升级请求。当在内部创建HTTP服务器或通过`server`选项传递HTTP服务器时，将自动调用此方法。</p>
<p>在“noServer”模式下操作时, 必须手动调用此方法。</p>
<p>如果升级成功, 则使用`WebSocket`对象作为参数调用`callback`。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.shouldHandle">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">shouldHandle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#server.shouldHandle" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
</ul>
</dd>
</dl>
<p>查看此服务器是否应处理给定请求。</p>
<p>默认情况下, 此方法验证请求的路径名, 并将其与`path`选项（如果提供）匹配。</p>
<p>返回值“true”或“false”确定是否接受握手。</p>
<p>当需要自定义处理逻辑时, 可以覆盖此方法。</p>
</dd></dl>

<p>就绪状态常数</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 10%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>不变</p></th>
<th class="head"><p>值</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CONNECTING</p></td>
<td><p>0</p></td>
<td><p>连接尚未打开。</p></td>
</tr>
<tr class="row-odd"><td><p>OPEN</p></td>
<td><p>1</p></td>
<td><p>连接已打开并准备好进行通信。</p></td>
</tr>
<tr class="row-even"><td><p>CLOSING</p></td>
<td><p>2</p></td>
<td><p>连接正在关闭。</p></td>
</tr>
<tr class="row-odd"><td><p>CLOSED</p></td>
<td><p>3</p></td>
<td><p>连接已关闭。</p></td>
</tr>
</tbody>
</table>
<dl class="js class">
<dt class="sig sig-object js" id="new-WebSocket">
<span id="new WebSocket"></span><em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">new</span> <span class="pre">WebSocket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">address[,</span> <span class="pre">protocols][,</span> <span class="pre">{followRedirects,...}]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#new-WebSocket" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String</span> <span class="pre">|</span> <span class="pre">url.URL()</span></code></span>) – The URL to which to connect.</p></li>
<li><p><strong>protocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String</span> <span class="pre">|</span> <span class="pre">Array()</span></code></span>) – The list of subprotocols.</p></li>
<li><p><strong>followRedirects</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Whether or not to follow redirects. Defaults to <cite>false</cite>.</p></li>
<li><p><strong>handshakeTimeout</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – Timeout in milliseconds for the handshake request. This is reset after every redirection.</p></li>
<li><p><strong>maxRedirects</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum number of redirects allowed. Defaults to 10.</p></li>
<li><p><strong>perMessageDeflate</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean</span> <span class="pre">|</span> <span class="pre">Object()</span></code></span>) – Enable/disable permessage-deflate. <cite>perMessageDeflate</cite> default value is <cite>true</cite>. When using an object, parameters are the same of the server.</p></li>
<li><p><strong>protocolVersion</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – Value of the <cite>Sec-WebSocket-Version</cite> header.</p></li>
<li><p><strong>origin</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – Value of the <cite>Origin</cite> or <cite>Sec-WebSocket-Origin</cite> header depending on the <cite>protocolVersion</cite>.</p></li>
<li><p><strong>maxPayload</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – <cite>maxPayload</cite> 允许的最大邮件大小（字节）。</p></li>
</ul>
</dd>
</dl>
<p><a href="#id1"><span class="problematic" id="id2">`</span></a>http.request（）`_或`https.request（）`_中允许的任何其他选项。</p>
</dd></dl>

<p>唯一的区别是请求的方向。</p>
<p>例如, <a href="#id1"><span class="problematic" id="id2">`</span></a>serverNoContextTakeover`可用于请求服务器禁用上下文接管。</p>
<p>创建一个新的WebSocket实例。</p>
<p><strong>UNIX Domain Sockets</strong></p>
<p><a href="#id1"><span class="problematic" id="id2">`</span></a>ws`支持向UNIX域套接字发出请求。要制作一个, 请使用以下URL方案：</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ws+unix:///absolute/path/to/uds_socket:/pathname?search_params
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p><a href="#id1"><span class="problematic" id="id2">`</span></a>：<a href="#id3"><span class="problematic" id="id4">`</span></a>是套接字路径和URL路径之间的分隔符。如果省略URL路径</p>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ws+unix:///absolute/path/to/uds_socket
</pre></div>
</div>
<p>它默认为`/<a href="#id1"><span class="problematic" id="id2">`</span></a>。</p>
<dl class="js function">
<dt class="sig sig-object js" id="id0">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>code: Number}</p></li>
<li><p>reason: String}</p></li>
</ul>
<p>连接关闭时发出。 <a href="#id1"><span class="problematic" id="id2">`</span></a>code`是一个数值, 表示状态代码, 解释连接关闭的原因。</p>
<p><a href="#id1"><span class="problematic" id="id2">`</span></a>reason`是一个人类可读的字符串, 解释连接已关闭的原因。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="id1">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">error</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id1" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>error: Error}</p></li>
</ul>
<p>发生错误时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.message">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">message</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.message" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: String|Buffer|ArrayBuffer|Buffer[]}</p></li>
</ul>
<p>从服务器收到消息时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.open">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">open</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.open" title="永久链接至目标"></a></dt>
<dd><p>建立连接时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.ping">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">ping</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.ping" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Buffer}</p></li>
</ul>
<p>从服务器收到ping时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.pong">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">pong</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.pong" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Buffer}</p></li>
</ul>
<p>从服务器收到乒乓时发出。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.unexpected-response">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">unexpected-response</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.unexpected-response" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>request: http.ClientRequest}</p></li>
<li><p>response: http.IncomingMessage}</p></li>
</ul>
<p>当服务器响应不是预期的响应时发出, 例如401响应。</p>
<p>此事件使您能够读取响应以提取有用信息。</p>
<p>如果服务器发送无效响应并且没有此事件的侦听器, 则会发出错误。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.upgrade">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">upgrade</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.upgrade" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>response: http.IncomingMessage}</p></li>
</ul>
<p>在作为握手的一部分从服务器接收响应头时发出。</p>
<p>这允许您从服务器读取标头, 例如“set-cookie”标头。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.addEventListener">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">addEventListener</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">type</span></em>, <em class="sig-param"><span class="pre">listener</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.addEventListener" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>type: String} A string representing the event type to listen for.</p></li>
<li><p>listener: Function} The listener to add.</p></li>
</ul>
<p>注册一个模拟`EventTarget`接口的事件监听器。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.binaryType">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">binaryType</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.binaryType" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{String}</p></li>
</ul>
<p>一个字符串, 指示连接传输的二进制数据的类型。</p>
<p>这应该是“nodebuffer ”, “arraybuffer ”或“fragments ”之一。</p>
<p>Defaults to “nodebuffer”.</p>
<p>Type “fragments” will emit the array of fragments as received from the sender, without copyfull concatenation, which is useful for the performance of binary protocols transferring large messages with multiple fragments.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.bufferedAmount">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">bufferedAmount</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.bufferedAmount" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Number}</p></li>
</ul>
<p>使用调用“send（）”但尚未传输到网络排队的数据的字节数。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.close">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="pre">code</span></em><span class="optional">[</span>, <em class="sig-param"><span class="pre">reason</span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.close" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>code: Number} A numeric value indicating the status code explaining why the connection is being closed.</p></li>
<li><p>reason: String} A human-readable string explaining why the connection is closing.</p></li>
</ul>
<p>发起结束握手。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.extensions">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">extensions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.extensions" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Object}</p></li>
</ul>
<p>包含协商扩展的对象。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onclose">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onclose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onclose" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>连接关闭时要调用的事件侦听器。</p>
<p>监听器接收名为“close”的`CloseEvent`。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onerror">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onerror</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onerror" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>发生错误时要调用的事件侦听器。</p>
<p>监听器收到一个名为“error”的`ErrorEvent`。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onmessage">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onmessage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onmessage" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>从服务器收到消息时要调用的事件侦听器。</p>
<p>监听器接收名为“message”的`MessageEvent`。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onopen">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onopen</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onopen" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>建立连接时要调用的事件侦听器。</p>
<p>监听器接收名为“open”的`OpenEvent`。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.ping">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">ping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">[data[,</span> <span class="pre">mask]][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.ping" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Any} The data to send in the ping frame.</p></li>
<li><p>mask: Boolean} Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p>callback: Function} An optional callback which is invoked when the ping frame is written out.</p></li>
</ul>
<p>Send a ping.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.pong">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">pong</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">[data[,</span> <span class="pre">mask]][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.pong" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Any} The data to send in the pong frame.</p></li>
<li><p>mask: Boolean} Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p>callback: Function} An optional callback which is invoked when the pong frame is written out.</p></li>
</ul>
<p>Send a pong.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.protocol">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">protocol</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.protocol" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{String}</p></li>
</ul>
<p>服务器选择的子协议。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.readyState">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">readyState</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.readyState" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Number}</p></li>
</ul>
<p>连接的当前状态。这是就绪状态常量之一。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.removeEventListener">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">removeEventListener</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">type</span></em>, <em class="sig-param"><span class="pre">listener</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.removeEventListener" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>type: String} A string representing the event type to remove.</p></li>
<li><p>listener: Function} The listener to remove.</p></li>
</ul>
</dd></dl>

<p>删除模拟`EventTarget`接口的事件侦听器。</p>
<dl class="js function">
<dt class="sig sig-object js" id="websocket.send">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data[,</span> <span class="pre">options][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.send" title="永久链接至目标"></a></dt>
<dd><ul>
<li><p>data: Any} The data to send.</p></li>
<li><p>options: Object}</p>
<ul class="simple">
<li><p>compress: Boolean} Specifies whether <cite>data</cite> should be compressed or not.Defaults to <cite>true</cite> when permessage-deflate is enabled.</p></li>
<li><p>binary: Boolean} Specifies whether <cite>data</cite> should be sent as a binary or not. Default is autodetected.</p></li>
<li><p>mask: Boolean} Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p>fin: Boolean} Specifies whether <cite>data</cite> is the last fragment of a message or not. Defaults to <cite>true</cite>.</p></li>
</ul>
</li>
<li><p>callback: Function An optional callback which is invoked when <cite>data</cite> is written out.</p>
<blockquote>
<div><p>通过连接发送`data`。</p>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.terminate">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">terminate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.terminate" title="永久链接至目标"></a></dt>
<dd><p>强行关闭连接。</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.url">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">url</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.url" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{String}</p></li>
</ul>
<p>WebSocket服务器的URL。服务器客户端没有此属性。</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quick-start.html" class="btn btn-neutral float-left" title="ws: a Node.js WebSocket library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2019, BandCap.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>