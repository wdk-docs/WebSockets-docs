<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ws &mdash; WebSockets Docs v2019.0613 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="koa-easy-ws" href="koa-easy-ws.html" />
    <link rel="prev" title="ws: a Node.js WebSocket library" href="quick-start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../contents.html" class="icon icon-home"> WebSockets Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API documention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../awesome.html">Awesome WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../socket.io/index.html">socket.io documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ws documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="koa-websocket.html">koa-websocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html">ws: a Node.js WebSocket library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ws</a></li>
<li class="toctree-l2"><a class="reference internal" href="koa-easy-ws.html">koa-easy-ws</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi-room.html">Websocket multi room based on ws.js</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blogs/index.html">Blogs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">WebSockets Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../contents.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">ws documentation</a> &raquo;</li>
      <li>ws</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ws/ws.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ws">
<h1>ws<a class="headerlink" href="#ws" title="永久链接至标题"></a></h1>
<dl class="js class">
<dt class="sig sig-object js" id="WebSocket.Server">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">WebSocket.</span></span><span class="sig-name descname"><span class="pre">Server</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">{host</span></em>, <em class="sig-param"><span class="pre">port</span></em>, <em class="sig-param"><span class="pre">server</span></em>, <em class="sig-param"><span class="pre">noServer...}</span></em><span class="optional">[</span>, <em class="sig-param"><span class="pre">callback</span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#WebSocket.Server" title="永久链接至目标"></a></dt>
<dd><p>This class represents a WebSocket server. It extends the <cite>EventEmitter</cite>.</p>
<p>new WebSocket.Server(options[, callback])</p>
<p>Create a new server instance. One of <cite>port</cite>, <cite>server</cite> or <cite>noServer</cite> must be provided or an error is thrown.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>host</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – The hostname where to bind the server.</p></li>
<li><p><strong>port</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The port where to bind the server.</p></li>
<li><p><strong>backlog</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum length of the queue of pending connections.</p></li>
<li><p><strong>server</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.Server</span> <span class="pre">|</span> <span class="pre">https.Server()</span></code></span>) – A pre-created Node.js HTTP/S server.</p></li>
<li><p><strong>verifyClient</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – A function which can be used to validate incoming connections. See description below.</p></li>
<li><p><strong>handleProtocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – A function which can be used to handle the WebSocket subprotocols. See description below.</p></li>
<li><p><strong>path</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – Accept only connections matching this path.</p></li>
<li><p><strong>noServer</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Enable no server mode.</p></li>
<li><p><strong>clientTracking</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Specifies whether or not to track clients.</p></li>
<li><p><strong>perMessageDeflate</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean</span> <span class="pre">|</span> <span class="pre">Object()</span></code></span>) – <p>Enable/disable permessage-deflate.</p>
<p><cite>perMessageDeflate</cite> can be used to control the behavior of <a class="reference external" href="permessage-deflate">permessage-deflate extension</a>.
he extension is disabled when <cite>false</cite> (default value).</p>
<p>If an object is provided then that is extension parameters:</p>
<blockquote>
<div><ul>
<li><p><strong>serverNoContextTakeover</strong>: (<em>Boolean</em>) - Whether to use context takeover or not.</p></li>
<li><p><strong>clientNoContextTakeover</strong>: (<em>Boolean</em>) - Acknowledge disabling of client context takeover.</p></li>
<li><p><strong>serverMaxWindowBits</strong>: (<em>Number</em>) - The value of <cite>windowBits</cite>.</p></li>
<li><p><strong>clientMaxWindowBits</strong>: (<em>Number</em>) - Request a custom client window size.</p></li>
<li><p><strong>zlibDeflateOptions</strong>: (<em>Object</em>) - Additional options &lt;zlib-options&gt;`_ to pass to zlib on deflate.</p></li>
<li><p><strong>zlibInflateOptions</strong>: (<em>Object</em>) - Additional options &lt;zlib-options&gt;`_ to pass to zlib on inflate.</p></li>
<li><p><strong>threshold</strong>: (<em>Number</em>) - Payloads smaller than this will not be compressed. Defaults to 1024 bytes.</p></li>
<li><p><strong>concurrencyLimit</strong>: (<em>Number</em>) - The number of concurrent calls to zlib. Calls above this limit will be queued. Default 10. You usually won’t need to touch this option. See <a class="reference external" href="concurrency-limit">this issue</a> for more details.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>maxPayload</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum allowed message size in bytes.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – <cite>callback</cite> will be added as a listener for the <cite>listening</cite> event on the HTTP server when not operating in “noServer” mode.</p></li>
</ul>
</dd>
</dl>
<p>An HTTP server is automatically created, started, and used if <cite>port</cite> is set.</p>
<p>To use an external HTTP/S server instead, specify only <cite>server</cite> or <cite>noServer</cite>.
In this case the HTTP/S server must be started manually. The “noServer” mode allows the WebSocket server to be completly detached from the HTTP/S server.
This makes it possible, for example, to share a single HTTP/S server between multiple WebSocket servers.</p>
<p>If <cite>verifyClient</cite> is not set then the handshake is automatically accepted.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="verifyClient">
<span class="sig-name descname"><span class="pre">verifyClient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">{origin</span></em>, <em class="sig-param"><span class="pre">req</span></em>, <em class="sig-param"><span class="pre">secure}</span></em><span class="optional">[</span>, <em class="sig-param"><span class="pre">cb</span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#verifyClient" title="永久链接至目标"></a></dt>
<dd><p>If it is provided with a single argument then that is:</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>origin</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – The value in the Origin header indicated by the client.</p></li>
<li><p><strong>req</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
<li><p><strong>secure</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – <cite>true</cite> if <cite>req.connection.authorized</cite> or <cite>req.connection.encrypted</cite> is set.</p></li>
</ul>
</dd>
</dl>
<p>The return value (Boolean) of the function determines whether or not to accept the handshake.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="verifyClient.cb">
<span class="sig-prename descclassname"><span class="pre">verifyClient.</span></span><span class="sig-name descname"><span class="pre">cb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">result</span></em>, <em class="sig-param"><span class="pre">code</span></em>, <em class="sig-param"><span class="pre">name</span></em>, <em class="sig-param"><span class="pre">headers</span></em><span class="sig-paren">)</span><a class="headerlink" href="#verifyClient.cb" title="永久链接至目标"></a></dt>
<dd><p>if <cite>verifyClient</cite> is provided with two arguments then those are:</p>
<p>A callback that must be called by the user upon inspection of the <cite>info</cite> fields.</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>result</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Whether or not to accept the handshake.</p></li>
<li><p><strong>code</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – When <cite>result</cite> is <cite>false</cite> this field determines the HTTP error status code to be sent to the client.</p></li>
<li><p><strong>name</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – When <cite>result</cite> is <cite>false</cite> this field determines the HTTP reason phrase.</p></li>
<li><p><strong>headers</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Object()</span></code></span>) – When <cite>result</cite> is <cite>false</cite> this field determines additional HTTP headers to be sent to the client. For example, <cite>{ ‘Retry-After’: 120 }</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="handleProtocols">
<span class="sig-name descname"><span class="pre">handleProtocols</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">protocols</span></em>, <em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#handleProtocols" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>protocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Array()</span></code></span>) – The list of WebSocket subprotocols indicated by the client in the <cite>Sec-WebSocket-Protocol</cite> header.</p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
</ul>
</dd>
</dl>
<p>The returned value sets the value of the <cite>Sec-WebSocket-Protocol</cite> header in the HTTP 101 response.</p>
<p>If returned value is <cite>false</cite> the header is not added in the response.</p>
<p>If <cite>handleProtocols</cite> is not set then the first of the client’s requested subprotocols is used.</p>
</dd></dl>

<p>If a property is empty then either an offered configuration or a default value is used. When sending a fragmented message the length of the first fragment is compared to the threshold.</p>
<p>This determines if compression is used for the entire message.</p>
<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.close">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.close" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the server closes. This event depends on the <cite>‘close’</cite> event of HTTP server only when it is created internally.</p>
<p>In all other cases, the event is emitted independently.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.connection">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">connection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">socket</span></em>, <em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.connection" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>socket</strong> (<span><a class="reference internal" href="../api/WebSocket.html#id0" title="WebSocket"><code class="xref js js-func docutils literal notranslate"><span class="pre">WebSocket()</span></code></a></span>) – </p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Emitted when the handshake is complete. <cite>request</cite> is the http GET request sent by the client.</p>
<p>Useful for parsing authority headers, cookie headers, and other information.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.error">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">error</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.error" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>error: Error</p></li>
</ul>
<p>Emitted when an error occurs on the underlying server.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.headers">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">headers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">headers</span></em>, <em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.headers" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>headers</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Array()</span></code></span>) – </p></li>
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Emitted before the response headers are written to the socket as part of the handshake.</p>
<p>This allows you to inspect/modify the headers before they are sent.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.listening">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">listening</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.listening" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the underlying server has been bound.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.address">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">address</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#server.address" title="永久链接至目标"></a></dt>
<dd><p>Returns an object with <cite>port</cite>, <cite>family</cite>, and <cite>address</cite> properties specifying the bound address, the address family name, and port of the server as reported by the operating system if listening on an IP socket.</p>
<p>If the server is listening on a pipe or UNIX domain socket, the name is returned as a string.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.clients">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">clients</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#server.clients" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Set}</p></li>
</ul>
<p>A set that stores all connected clients. Please note that this property is only added when the <cite>clientTracking</cite> is truthy.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.close">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="pre">callback</span></em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#server.close" title="永久链接至目标"></a></dt>
<dd><p>Close the HTTP server if created internally, terminate all clients and call callback when done.</p>
<p>If an external HTTP server is used via the <cite>server</cite> or <cite>noServer</cite> constructor options, it must be closed manually.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.handleUpgrade">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">handleUpgrade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">request</span></em>, <em class="sig-param"><span class="pre">socket</span></em>, <em class="sig-param"><span class="pre">head</span></em>, <em class="sig-param"><span class="pre">callback</span></em><span class="sig-paren">)</span><a class="headerlink" href="#server.handleUpgrade" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
<li><p><strong>socket</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">net.Socket()</span></code></span>) – The network socket between the server and client.</p></li>
<li><p><strong>head</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Buffer()</span></code></span>) – The first packet of the upgraded stream.</p></li>
<li><p><strong>callback</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Function()</span></code></span>) – </p></li>
</ul>
</dd>
</dl>
<p>Handle a HTTP upgrade request. When the HTTP server is created internally or when the HTTP server is passed via the <cite>server</cite> option, this method is called automatically.</p>
<p>When operating in “noServer” mode, this method must be called manually.</p>
<p>If the upgrade is successful, the <cite>callback</cite> is called with a <cite>WebSocket</cite> object as parameter.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="server.shouldHandle">
<span class="sig-prename descclassname"><span class="pre">server.</span></span><span class="sig-name descname"><span class="pre">shouldHandle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">request</span></em><span class="sig-paren">)</span><a class="headerlink" href="#server.shouldHandle" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">http.IncomingMessage()</span></code></span>) – The client HTTP GET request.</p></li>
</ul>
</dd>
</dl>
<p>See if a given request should be handled by this server.</p>
<p>By default this method validates the pathname of the request, matching it against the <cite>path</cite> option if provided.</p>
<p>The return value, <cite>true</cite> or <cite>false</cite>, determines whether or not to accept the handshake.</p>
<p>This method can be overridden when a custom handling logic is required.</p>
</dd></dl>

<p>Ready state constants</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 10%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Constant</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CONNECTING</p></td>
<td><p>0</p></td>
<td><p>The connection is not yet open.</p></td>
</tr>
<tr class="row-odd"><td><p>OPEN</p></td>
<td><p>1</p></td>
<td><p>The connection is open and ready to communicate.</p></td>
</tr>
<tr class="row-even"><td><p>CLOSING</p></td>
<td><p>2</p></td>
<td><p>The connection is in the process of closing.</p></td>
</tr>
<tr class="row-odd"><td><p>CLOSED</p></td>
<td><p>3</p></td>
<td><p>The connection is closed.</p></td>
</tr>
</tbody>
</table>
<dl class="js class">
<dt class="sig sig-object js" id="new-WebSocket">
<span id="new WebSocket"></span><em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">new</span> <span class="pre">WebSocket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">address[,</span> <span class="pre">protocols][,</span> <span class="pre">{followRedirects,...}]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#new-WebSocket" title="永久链接至目标"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String</span> <span class="pre">|</span> <span class="pre">url.URL()</span></code></span>) – The URL to which to connect.</p></li>
<li><p><strong>protocols</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String</span> <span class="pre">|</span> <span class="pre">Array()</span></code></span>) – The list of subprotocols.</p></li>
<li><p><strong>followRedirects</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean()</span></code></span>) – Whether or not to follow redirects. Defaults to <cite>false</cite>.</p></li>
<li><p><strong>handshakeTimeout</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – Timeout in milliseconds for the handshake request. This is reset after every redirection.</p></li>
<li><p><strong>maxRedirects</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum number of redirects allowed. Defaults to 10.</p></li>
<li><p><strong>perMessageDeflate</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Boolean</span> <span class="pre">|</span> <span class="pre">Object()</span></code></span>) – Enable/disable permessage-deflate. <cite>perMessageDeflate</cite> default value is <cite>true</cite>. When using an object, parameters are the same of the server.</p></li>
<li><p><strong>protocolVersion</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – Value of the <cite>Sec-WebSocket-Version</cite> header.</p></li>
<li><p><strong>origin</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">String()</span></code></span>) – Value of the <cite>Origin</cite> or <cite>Sec-WebSocket-Origin</cite> header depending on the <cite>protocolVersion</cite>.</p></li>
<li><p><strong>maxPayload</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">Number()</span></code></span>) – The maximum allowed message size in bytes.</p></li>
</ul>
</dd>
</dl>
<p>Any other option allowed in <a class="reference external" href="https://nodejs.org/api/http.html#http_http_request_options_callback">http.request()</a> or <a class="reference external" href="https://nodejs.org/api/https.html#https_https_request_options_callback">https.request()</a>.</p>
</dd></dl>

<p>The only difference is the direction of requests.</p>
<p>For example, <cite>serverNoContextTakeover</cite> can be used to ask the server to disable context takeover.</p>
<p>Create a new WebSocket instance.</p>
<p><strong>UNIX Domain Sockets</strong></p>
<p><cite>ws</cite> supports making requests to UNIX domain sockets. To make one, use the following URL scheme:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ws+unix:///absolute/path/to/uds_socket:/pathname?search_params
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>that <cite>:</cite> is the separator between the socket path and the URL path. If the URL path is omitted</p>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ws+unix:///absolute/path/to/uds_socket
</pre></div>
</div>
<p>it defaults to <cite>/</cite>.</p>
<dl class="js function">
<dt class="sig sig-object js" id="id0">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>code: Number}</p></li>
<li><p>reason: String}</p></li>
</ul>
<p>Emitted when the connection is closed. <cite>code</cite> is a numeric value indicating the status code explaining why the connection has been closed.</p>
<p><cite>reason</cite> is a human-readable string explaining why the connection has been closed.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="id1">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">error</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id1" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>error: Error}</p></li>
</ul>
<p>Emitted when an error occurs.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.message">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">message</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.message" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: String|Buffer|ArrayBuffer|Buffer[]}</p></li>
</ul>
<p>Emitted when a message is received from the server.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.open">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">open</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.open" title="永久链接至目标"></a></dt>
<dd><p>Emitted when the connection is established.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.ping">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">ping</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.ping" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Buffer}</p></li>
</ul>
<p>Emitted when a ping is received from the server.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.pong">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">pong</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.pong" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Buffer}</p></li>
</ul>
<p>Emitted when a pong is received from the server.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.unexpected-response">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">unexpected-response</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.unexpected-response" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>request: http.ClientRequest}</p></li>
<li><p>response: http.IncomingMessage}</p></li>
</ul>
<p>Emitted when the server response is not the expected one, for example a 401 response.</p>
<p>This event gives the ability to read the response in order to extract useful information.</p>
<p>If the server sends an invalid response and there isn’t a listener for this event, an error is emitted.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ws.onEvent.upgrade">
<span class="sig-prename descclassname"><span class="pre">ws.onEvent.</span></span><span class="sig-name descname"><span class="pre">upgrade</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ws.onEvent.upgrade" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>response: http.IncomingMessage}</p></li>
</ul>
<p>Emitted when response headers are received from the server as part of the handshake.</p>
<p>This allows you to read headers from the server, for example ‘set-cookie’ headers.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.addEventListener">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">addEventListener</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">type</span></em>, <em class="sig-param"><span class="pre">listener</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.addEventListener" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>type: String} A string representing the event type to listen for.</p></li>
<li><p>listener: Function} The listener to add.</p></li>
</ul>
<p>Register an event listener emulating the <cite>EventTarget</cite> interface.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.binaryType">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">binaryType</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.binaryType" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{String}</p></li>
</ul>
<p>A string indicating the type of binary data being transmitted by the connection.</p>
<p>This should be one of “nodebuffer”, “arraybuffer” or “fragments”.</p>
<p>Defaults to “nodebuffer”.</p>
<p>Type “fragments” will emit the array of fragments as received from the sender, without copyfull concatenation, which is useful for the performance of binary protocols transferring large messages with multiple fragments.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.bufferedAmount">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">bufferedAmount</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.bufferedAmount" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Number}</p></li>
</ul>
<p>The number of bytes of data that have been queued using calls to <cite>send()</cite> but not yet transmitted to the network.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.close">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="pre">code</span></em><span class="optional">[</span>, <em class="sig-param"><span class="pre">reason</span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.close" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>code: Number} A numeric value indicating the status code explaining why the connection is being closed.</p></li>
<li><p>reason: String} A human-readable string explaining why the connection is closing.</p></li>
</ul>
<p>Initiate a closing handshake.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.extensions">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">extensions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.extensions" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Object}</p></li>
</ul>
<p>An object containing the negotiated extensions.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onclose">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onclose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onclose" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>An event listener to be called when connection is closed.</p>
<p>The listener receives a <cite>CloseEvent</cite> named “close”.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onerror">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onerror</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onerror" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>An event listener to be called when an error occurs.</p>
<p>The listener receives an <cite>ErrorEvent</cite> named “error”.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onmessage">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onmessage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onmessage" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>An event listener to be called when a message is received from the server.</p>
<p>The listener receives a <cite>MessageEvent</cite> named “message”.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.onopen">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">onopen</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.onopen" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Function}</p></li>
</ul>
<p>An event listener to be called when the connection is established.</p>
<p>The listener receives an <cite>OpenEvent</cite> named “open”.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.ping">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">ping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">[data[,</span> <span class="pre">mask]][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.ping" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Any} The data to send in the ping frame.</p></li>
<li><p>mask: Boolean} Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p>callback: Function} An optional callback which is invoked when the ping frame is written out.</p></li>
</ul>
<p>Send a ping.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.pong">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">pong</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">[data[,</span> <span class="pre">mask]][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.pong" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>data: Any} The data to send in the pong frame.</p></li>
<li><p>mask: Boolean} Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p>callback: Function} An optional callback which is invoked when the pong frame is written out.</p></li>
</ul>
<p>Send a pong.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.protocol">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">protocol</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.protocol" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{String}</p></li>
</ul>
<p>The subprotocol selected by the server.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.readyState">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">readyState</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.readyState" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{Number}</p></li>
</ul>
<p>The current state of the connection. This is one of the ready state constants.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.removeEventListener">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">removeEventListener</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">type</span></em>, <em class="sig-param"><span class="pre">listener</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.removeEventListener" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>type: String} A string representing the event type to remove.</p></li>
<li><p>listener: Function} The listener to remove.</p></li>
</ul>
</dd></dl>

<p>Removes an event listener emulating the <cite>EventTarget</cite> interface.</p>
<dl class="js function">
<dt class="sig sig-object js" id="websocket.send">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data[,</span> <span class="pre">options][,</span> <span class="pre">callback]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#websocket.send" title="永久链接至目标"></a></dt>
<dd><ul>
<li><p>data: Any} The data to send.</p></li>
<li><p>options: Object}</p>
<ul class="simple">
<li><p>compress: Boolean} Specifies whether <cite>data</cite> should be compressed or not.Defaults to <cite>true</cite> when permessage-deflate is enabled.</p></li>
<li><p>binary: Boolean} Specifies whether <cite>data</cite> should be sent as a binary or not. Default is autodetected.</p></li>
<li><p>mask: Boolean} Specifies whether <cite>data</cite> should be masked or not. Defaults to <cite>true</cite> when <cite>websocket</cite> is not a server client.</p></li>
<li><p>fin: Boolean} Specifies whether <cite>data</cite> is the last fragment of a message or not. Defaults to <cite>true</cite>.</p></li>
</ul>
</li>
<li><p>callback: Function An optional callback which is invoked when <cite>data</cite> is written out.</p>
<blockquote>
<div><p>Send <cite>data</cite> through the connection.</p>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.terminate">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">terminate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.terminate" title="永久链接至目标"></a></dt>
<dd><p>Forcibly close the connection.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="websocket.url">
<span class="sig-prename descclassname"><span class="pre">websocket.</span></span><span class="sig-name descname"><span class="pre">url</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#websocket.url" title="永久链接至目标"></a></dt>
<dd><ul class="simple">
<li><p>{String}</p></li>
</ul>
<p>The URL of the WebSocket server. Server clients don’t have this attribute.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quick-start.html" class="btn btn-neutral float-left" title="ws: a Node.js WebSocket library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="koa-easy-ws.html" class="btn btn-neutral float-right" title="koa-easy-ws" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2019, BandCap.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>