

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Socket &mdash; WebSockets Docs v2019.0613 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="客户端" href="Client.html" />
    <link rel="prev" title="命名空间" href="Namespace.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../contents.html" class="icon icon-home"> WebSockets Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API documention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../awesome.html">Awesome WebSockets</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">socket.io 文档</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../get-started.html">聊天 - 入门</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client-api/index.html">客户端 API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">服务端API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="API.html">服务端 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="Namespace.html">命名空间</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Socket</a></li>
<li class="toctree-l3"><a class="reference internal" href="Client.html">客户端</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../demos/index.html">演示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket.io-protocol.html">socket.io-protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_posts/index.html">发布历史记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket-io-with-apache-cordova.html">Socket.IO — Apache Cordova</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ws/index.html">ws documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">WebSockets Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">socket.io 文档</a> &raquo;</li>
        
          <li><a href="index.html">服务端API</a> &raquo;</li>
        
      <li>Socket</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/socket.io/server-api/Socket.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="socket">
<h1>Socket<a class="headerlink" href="#socket" title="永久链接至标题">¶</a></h1>
<p>A <code class="docutils literal notranslate"><span class="pre">Socket</span></code> is the fundamental class for interacting with browser
clients. A <code class="docutils literal notranslate"><span class="pre">Socket</span></code> belongs to a certain <code class="docutils literal notranslate"><span class="pre">Namespace</span></code> (by default
<code class="docutils literal notranslate"><span class="pre">/</span></code>) and uses an underlying <code class="docutils literal notranslate"><span class="pre">Client</span></code> to communicate.</p>
<p>It should be noted the <code class="docutils literal notranslate"><span class="pre">Socket</span></code> doesn’t relate directly to the actual
underlying TCP/IP <code class="docutils literal notranslate"><span class="pre">socket</span></code> and it is only the name of the class.</p>
<p>Within each <code class="docutils literal notranslate"><span class="pre">Namespace</span></code>, you can also define arbitrary channels
(called <code class="docutils literal notranslate"><span class="pre">room</span></code>) that the <code class="docutils literal notranslate"><span class="pre">Socket</span></code> can join and leave. That provides
a convenient way to broadcast to a group of <code class="docutils literal notranslate"><span class="pre">Socket</span></code>s (see
<code class="docutils literal notranslate"><span class="pre">Socket#to</span></code> below).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Socket</span></code> class inherits from
<a class="reference external" href="https://nodejs.org/api/events.html#events_class_eventemitter">EventEmitter</a>.
The <code class="docutils literal notranslate"><span class="pre">Socket</span></code> class overrides the <code class="docutils literal notranslate"><span class="pre">emit</span></code> method, and does not modify
any other <code class="docutils literal notranslate"><span class="pre">EventEmitter</span></code> method. All methods documented here which
also appear as <code class="docutils literal notranslate"><span class="pre">EventEmitter</span></code> methods (apart from <code class="docutils literal notranslate"><span class="pre">emit</span></code>) are
implemented by <code class="docutils literal notranslate"><span class="pre">EventEmitter</span></code>, and documentation for <code class="docutils literal notranslate"><span class="pre">EventEmitter</span></code>
applies.</p>
<dl class="attribute">
<dt id="socket.id">
<code class="descclassname">socket.</code><code class="descname">id</code><a class="headerlink" href="#socket.id" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><em>(String)</em></p></li>
</ul>
<p>A unique identifier for the session, that comes from the underlying
<code class="docutils literal notranslate"><span class="pre">Client</span></code>.</p>
<dl class="attribute">
<dt id="socket.rooms">
<code class="descclassname">socket.</code><code class="descname">rooms</code><a class="headerlink" href="#socket.rooms" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><em>(Object)</em></p></li>
</ul>
<p>A hash of strings identifying the rooms this client is in, indexed by
room name.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;room 237&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">rooms</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">rooms</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">rooms</span><span class="p">);</span> <span class="c1">// [ &lt;socket.id&gt;, &#39;room 237&#39; ]</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="socket.client">
<code class="descclassname">socket.</code><code class="descname">client</code><a class="headerlink" href="#socket.client" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><em>(Client)</em></p></li>
</ul>
<p>A reference to the underlying <code class="docutils literal notranslate"><span class="pre">Client</span></code> object.</p>
<dl class="attribute">
<dt id="socket.conn">
<code class="descclassname">socket.</code><code class="descname">conn</code><a class="headerlink" href="#socket.conn" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><em>(engine.Socket)</em></p></li>
</ul>
<p>A reference to the underlying <code class="docutils literal notranslate"><span class="pre">Client</span></code> transport connection (engine.io
<code class="docutils literal notranslate"><span class="pre">Socket</span></code> object). This allows access to the IO transport layer, which
still (mostly) abstracts the actual TCP/IP socket.</p>
<dl class="attribute">
<dt id="socket.request">
<code class="descclassname">socket.</code><code class="descname">request</code><a class="headerlink" href="#socket.request" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><em>(Request)</em></p></li>
</ul>
<p>A getter proxy that returns the reference to the <code class="docutils literal notranslate"><span class="pre">request</span></code> that
originated the underlying engine.io <code class="docutils literal notranslate"><span class="pre">Client</span></code>. Useful for accessing
request headers such as <code class="docutils literal notranslate"><span class="pre">Cookie</span></code> or <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code>.</p>
<dl class="attribute">
<dt id="socket.handshake">
<code class="descclassname">socket.</code><code class="descname">handshake</code><a class="headerlink" href="#socket.handshake" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><em>(Object)</em></p></li>
</ul>
<p>The handshake details:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="cm">/* the headers sent as part of the handshake */</span><span class="p">,</span>
  <span class="nx">time</span><span class="o">:</span> <span class="cm">/* the date of creation (as string) */</span><span class="p">,</span>
  <span class="nx">address</span><span class="o">:</span> <span class="cm">/* the ip of the client */</span><span class="p">,</span>
  <span class="nx">xdomain</span><span class="o">:</span> <span class="cm">/* whether the connection is cross-domain */</span><span class="p">,</span>
  <span class="nx">secure</span><span class="o">:</span> <span class="cm">/* whether the connection is secure */</span><span class="p">,</span>
  <span class="nx">issued</span><span class="o">:</span> <span class="cm">/* the date of creation (as unix timestamp) */</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="cm">/* the request URL string */</span><span class="p">,</span>
  <span class="nx">query</span><span class="o">:</span> <span class="cm">/* the query object */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Usage:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">handshake</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">handshake</span><span class="p">;</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">handshake</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">handshake</span><span class="p">;</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="socket.use">
<code class="descclassname">socket.</code><code class="descname">use</code><a class="headerlink" href="#socket.use" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fn</span></code> <em>(Function)</em></p></li>
</ul>
<p>Registers a middleware, which is a function that gets executed for every
incoming <code class="docutils literal notranslate"><span class="pre">Packet</span></code> and receives as parameter the packet and a function
to optionally defer execution to the next registered middleware.</p>
<p>Errors passed to middleware callbacks are sent as special <code class="docutils literal notranslate"><span class="pre">error</span></code>
packets to clients.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">packet</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">packet</span><span class="p">.</span><span class="nx">doge</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="nx">next</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Not a doge error&#39;</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="socket.send">
<code class="descclassname">socket.</code><code class="descname">send</code><a class="headerlink" href="#socket.send" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ack</span></code> <em>(Function)</em></p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code></p></li>
</ul>
<p>Sends a <code class="docutils literal notranslate"><span class="pre">message</span></code> event. See <a class="reference external" href="#socketemiteventname-args-ack">socket.emit(eventName[, …args][,
ack])</a>.</p>
<dl class="attribute">
<dt id="socket.emit">
<code class="descclassname">socket.</code><code class="descname">emit</code><a class="headerlink" href="#socket.emit" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p><em>(overrides ``EventEmitter.emit``)</em> - <code class="docutils literal notranslate"><span class="pre">eventName</span></code> <em>(String)</em> -
<code class="docutils literal notranslate"><span class="pre">args</span></code> - <code class="docutils literal notranslate"><span class="pre">ack</span></code> <em>(Function)</em> - <strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code></p>
<p>Emits an event to the socket identified by the string name. Any other
parameters can be included. All serializable datastructures are
supported, including <code class="docutils literal notranslate"><span class="pre">Buffer</span></code>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">);</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;with-binary&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="mi">3</span><span class="o">:</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">});</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ack</span></code> argument is optional and will be called with the client’s
answer.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;an event&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">some</span><span class="o">:</span> <span class="s1">&#39;data&#39;</span> <span class="p">});</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;ferret&#39;</span><span class="p">,</span> <span class="s1">&#39;tobi&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="c1">// data will be &#39;woot&#39;</span>
  <span class="p">});</span>

  <span class="c1">// the client code</span>
  <span class="c1">// client.on(&#39;ferret&#39;, (name, fn) =&gt; {</span>
  <span class="c1">//   fn(&#39;woot&#39;);</span>
  <span class="c1">// });</span>

<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="socket.on">
<code class="descclassname">socket.</code><code class="descname">on</code><a class="headerlink" href="#socket.on" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p><em>(inherited from ``EventEmitter``)</em> - <code class="docutils literal notranslate"><span class="pre">eventName</span></code> <em>(String)</em> -
<code class="docutils literal notranslate"><span class="pre">callback</span></code> <em>(Function)</em> - <strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code></p>
<p>Register a new handler for the given event.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;news&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// with several arguments</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;news&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
<span class="c1">// or with acknowledgement</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;news&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">callback</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="socket.once">
<code class="descclassname">socket.</code><code class="descname">once</code><a class="headerlink" href="#socket.once" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="socket.removeListener">
<code class="descclassname">socket.</code><code class="descname">removeListener</code><a class="headerlink" href="#socket.removeListener" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="socket.removeAllListeners">
<code class="descclassname">socket.</code><code class="descname">removeAllListeners</code><a class="headerlink" href="#socket.removeAllListeners" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="socket.eventNames">
<code class="descclassname">socket.</code><code class="descname">eventNames</code><a class="headerlink" href="#socket.eventNames" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Inherited from <code class="docutils literal notranslate"><span class="pre">EventEmitter</span></code> (along with other methods not mentioned
here). See Node.js documentation for the <code class="docutils literal notranslate"><span class="pre">events</span></code> module.</p>
<dl class="attribute">
<dt id="socket.join">
<code class="descclassname">socket.</code><code class="descname">join</code><a class="headerlink" href="#socket.join" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">room</span></code> <em>(String)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callback</span></code> <em>(Function)</em></p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code> for chaining</p></li>
</ul>
<p>Adds the client to the <code class="docutils literal notranslate"><span class="pre">room</span></code>, and fires optionally a callback with
<code class="docutils literal notranslate"><span class="pre">err</span></code> signature (if any).</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;room 237&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">rooms</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">rooms</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">rooms</span><span class="p">);</span> <span class="c1">// [ &lt;socket.id&gt;, &#39;room 237&#39; ]</span>
    <span class="nx">io</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;room 237&#39;</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;a new user has joined the room&#39;</span><span class="p">);</span> <span class="c1">// broadcast to everyone in the room</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The mechanics of joining rooms are handled by the <code class="docutils literal notranslate"><span class="pre">Adapter</span></code> that has
been configured (see <code class="docutils literal notranslate"><span class="pre">Server#adapter</span></code> above), defaulting to
<a class="reference external" href="https://github.com/socketio/socket.io-adapter">socket.io-adapter</a>.</p>
<p>For your convenience, each socket automatically joins a room identified
by its id (see <code class="docutils literal notranslate"><span class="pre">Socket#id</span></code>). This makes it easy to broadcast messages
to other sockets:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;say to someone&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// send a private message to the socket with the given id</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;my message&#39;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt>
<code class="descclassname">socket.</code><code class="descname">join</code></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rooms</span></code> <em>(Array)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callback</span></code> <em>(Function)</em></p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code> for chaining</p></li>
</ul>
<p>Adds the client to the list of room, and fires optionally a callback
with <code class="docutils literal notranslate"><span class="pre">err</span></code> signature (if any).</p>
<dl class="attribute">
<dt id="socket.leave">
<code class="descclassname">socket.</code><code class="descname">leave</code><a class="headerlink" href="#socket.leave" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">room</span></code> <em>(String)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callback</span></code> <em>(Function)</em></p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code> for chaining</p></li>
</ul>
<p>Removes the client from <code class="docutils literal notranslate"><span class="pre">room</span></code>, and fires optionally a callback with
<code class="docutils literal notranslate"><span class="pre">err</span></code> signature (if any).</p>
<p><strong>Rooms are left automatically upon disconnection</strong>.</p>
<dl class="attribute">
<dt id="socket.to">
<code class="descclassname">socket.</code><code class="descname">to</code><a class="headerlink" href="#socket.to" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">room</span></code> <em>(String)</em></p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code> for chaining</p></li>
</ul>
<p>Sets a modifier for a subsequent event emission that the event will only
be <em>broadcasted</em> to clients that have joined the given <code class="docutils literal notranslate"><span class="pre">room</span></code> (the
socket itself being excluded).</p>
<p>To emit to multiple rooms, you can call <code class="docutils literal notranslate"><span class="pre">to</span></code> several times.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>

  <span class="c1">// to one room</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;others&#39;</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;an event&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">some</span><span class="o">:</span> <span class="s1">&#39;data&#39;</span> <span class="p">});</span>

  <span class="c1">// to multiple rooms</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;room1&#39;</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;room2&#39;</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>

  <span class="c1">// a private message to another socket</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="cm">/* another socket id */</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;hey&#39;</span><span class="p">);</span>

  <span class="c1">// WARNING: `socket.to(socket.id).emit()` will NOT work, as it will send to everyone in the room</span>
  <span class="c1">// named `socket.id` but the sender. Please use the classic `socket.emit()` instead.</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>acknowledgements are not supported when broadcasting.</p>
</div>
<dl class="attribute">
<dt id="socket.in">
<code class="descclassname">socket.</code><code class="descname">in</code><a class="headerlink" href="#socket.in" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Synonym of <a class="reference external" href="#socket-to-room">socket.to(room)</a>.</p>
<dl class="attribute">
<dt id="socket.compress">
<code class="descclassname">socket.</code><code class="descname">compress</code><a class="headerlink" href="#socket.compress" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> <em>(Boolean)</em> whether to following packet will be compressed</p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code> for chaining</p></li>
</ul>
<p>Sets a modifier for a subsequent event emission that the event data will
only be <em>compressed</em> if the value is <code class="docutils literal notranslate"><span class="pre">true</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code> when
you don’t call the method.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">compress</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;uncompressed&#39;</span><span class="p">,</span> <span class="s2">&quot;that&#39;s rough&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="socket.disconnect">
<code class="descclassname">socket.</code><code class="descname">disconnect</code><a class="headerlink" href="#socket.disconnect" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">close</span></code> <em>(Boolean)</em> whether to close the underlying connection</p></li>
<li><p><strong>Returns</strong> <code class="docutils literal notranslate"><span class="pre">Socket</span></code></p></li>
</ul>
<p>Disconnects this client. If value of close is <code class="docutils literal notranslate"><span class="pre">true</span></code>, closes the
underlying connection. Otherwise, it just disconnects the namespace.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span> <span class="mi">5000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="Flag.broadcast">
<code class="descclassname">Flag.</code><code class="descname">broadcast</code><a class="headerlink" href="#Flag.broadcast" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Sets a modifier for a subsequent event emission that the event data will
only be <em>broadcast</em> to every sockets but the sender.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;an event&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">some</span><span class="o">:</span> <span class="s1">&#39;data&#39;</span> <span class="p">});</span> <span class="c1">// everyone gets it but the sender</span>
<span class="p">});</span>
</pre></div>
</div>
<span class="target" id="flag-volatile-1"></span><dl class="attribute">
<dt id="Flag.volatile">
<code class="descclassname">Flag.</code><code class="descname">volatile</code><a class="headerlink" href="#Flag.volatile" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Sets a modifier for a subsequent event emission that the event data may
be lost if the client is not ready to receive messages (because of
network slowness or other issues, or because they’re connected through
long polling and is in the middle of a request-response cycle).</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="kr">volatile</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;an event&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">some</span><span class="o">:</span> <span class="s1">&#39;data&#39;</span> <span class="p">});</span> <span class="c1">// the client may or may not receive it</span>
<span class="p">});</span>
</pre></div>
</div>
<span class="target" id="flag-binary-1"></span><dl class="attribute">
<dt id="Flag.binary">
<code class="descclassname">Flag.</code><code class="descname">binary</code><a class="headerlink" href="#Flag.binary" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Specifies whether there is binary data in the emitted data. Increases
performance when specified. Can be <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">)();</span>
<span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">binary</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;an event&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">some</span><span class="o">:</span> <span class="s1">&#39;data&#39;</span> <span class="p">});</span> <span class="c1">// The data to send has no binary data</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="Event.disconnect">
<code class="descclassname">Event.</code><code class="descname">disconnect</code><a class="headerlink" href="#Event.disconnect" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reason</span></code> <em>(String)</em> the reason of the disconnection (either client
or server-side)</p></li>
</ul>
<p>Fired upon disconnection.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Possible reasons:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 19%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Reason</p></th>
<th class="head"><p>Side</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">transport</span> <span class="pre">err</span>
<span class="pre">or</span></code></p></td>
<td><p>Server Side</p></td>
<td><p>Transport error</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">server</span> <span class="pre">namesp</span>
<span class="pre">ace</span> <span class="pre">disconnect</span></code></p></td>
<td><p>Server Side</p></td>
<td><p>Server performs a
<code class="docutils literal notranslate"><span class="pre">socket.disconnect()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">client</span> <span class="pre">namesp</span>
<span class="pre">ace</span> <span class="pre">disconnect</span></code></p></td>
<td><p>Client Side</p></td>
<td><p>Got disconnect packet from client</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ping</span> <span class="pre">timeout</span></code></p></td>
<td><p>Client Side</p></td>
<td><p>Client stopped responding to pings
in the allowed amount of time (per
the <code class="docutils literal notranslate"><span class="pre">pingTimeout</span></code> config setting)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">transport</span> <span class="pre">clo</span>
<span class="pre">se</span></code></p></td>
<td><p>Client Side</p></td>
<td><p>Client stopped sending data</p></td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="Event.error">
<code class="descclassname">Event.</code><code class="descname">error</code><a class="headerlink" href="#Event.error" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code> <em>(Object)</em> error object</p></li>
</ul>
<p>Fired when an error occurs.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="Event.disconnecting">
<code class="descclassname">Event.</code><code class="descname">disconnecting</code><a class="headerlink" href="#Event.disconnecting" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reason</span></code> <em>(String)</em> the reason of the disconnection (either client
or server-side)</p></li>
</ul>
<p>Fired when the client is going to be disconnected (but hasn’t left its
<code class="docutils literal notranslate"><span class="pre">rooms</span></code> yet).</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnecting&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">rooms</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">rooms</span><span class="p">);</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>These are reserved events (along with <code class="docutils literal notranslate"><span class="pre">connect</span></code>, <code class="docutils literal notranslate"><span class="pre">newListener</span></code> and
<code class="docutils literal notranslate"><span class="pre">removeListener</span></code>) which cannot be used as event names.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Client.html" class="btn btn-neutral float-right" title="客户端" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Namespace.html" class="btn btn-neutral float-left" title="命名空间" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>