<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Migrating from 0.9 &mdash; WebSockets Docs v2022.1115 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Using multiple nodes" href="using-multiple-nodes.html" />
    <link rel="prev" title="Rooms and namespaces" href="rooms-and-namespaces.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../contents.html" class="icon icon-home"> WebSockets Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../awesome.html">Awesome WebSockets</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">socket.io 文档</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../get-started.html">Chat - Get Started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Docs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="info.html">introduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="rooms-and-namespaces.html">Rooms and namespaces</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Migrating from 0.9</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentication-differences">Authentication differences</a></li>
<li class="toctree-l4"><a class="reference internal" href="#log-differences">Log differences</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shortcuts">Shortcuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-differences">Configuration differences</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parser-protocol-differences">Parser / Protocol differences</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="using-multiple-nodes.html">Using multiple nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging-and-debugging.html">Logging and debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="emit-cheatsheet.html">Emit cheatsheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals.html">Internals</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals.html#under-the-hood">Under the hood</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../client-api/index.html">Client API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server-api/index.html">Serve API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demos/index.html">Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket.io-protocol.html">socket.io-protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_posts/index.html">Release history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket-io-with-apache-cordova.html">Socket.IO — Apache Cordova</a></li>
<li class="toctree-l2"><a class="reference internal" href="../weapp.socket.io.html">weapp.socket.io</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ws/index.html">ws 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/index.html">博客</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">WebSockets Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../contents.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">socket.io 文档</a></li>
          <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
      <li class="breadcrumb-item active">Migrating from 0.9</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/socket.io/docs/migrating-from-0-9.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="migrating-from-0-9">
<h1>Migrating from 0.9<a class="headerlink" href="#migrating-from-0-9" title="此标题的永久链接"></a></h1>
<p>For most applications, the transition to 1.0 should be completely
seamless and devoid of any hiccups. That said, we’ve done some work to
streamline some APIs, and we have changed some internals, so this is a
recommended read for most existing users.</p>
<section id="authentication-differences">
<h2>Authentication differences<a class="headerlink" href="#authentication-differences" title="此标题的永久链接"></a></h2>
<section id="socket-io-uses-middleware-now">
<h3>Socket.io uses middleware now<a class="headerlink" href="#socket-io-uses-middleware-now" title="此标题的永久链接"></a></h3>
<p>You can give a Socket.io server arbitrary functions via <code class="docutils literal notranslate"><span class="pre">io.use()</span></code>
that are run when a socket is created. Check out this example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">srv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">).</span><span class="nx">createServer</span><span class="p">();</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">)(</span><span class="nx">srv</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"></span>
<span class="nx">io</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">){</span><span class="w"></span>
<span class="w">  </span><span class="nx">run</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0 -&gt; 1</span><span class="w"></span>
<span class="w">  </span><span class="nx">next</span><span class="p">();</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
<span class="nx">io</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">run</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 -&gt; 2</span><span class="w"></span>
<span class="w">  </span><span class="nx">next</span><span class="p">();</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io-client&#39;</span><span class="p">)();</span><span class="w"></span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(){</span><span class="w"></span>
<span class="w">  </span><span class="c1">// run == 2 at this time</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="so-its-cleaner-to-do-auth-via-middleware-now">
<h3>… so its cleaner to do auth via middleware now<a class="headerlink" href="#so-its-cleaner-to-do-auth-via-middleware-now" title="此标题的永久链接"></a></h3>
<p>The old <code class="docutils literal notranslate"><span class="pre">io.set()</span></code> and <code class="docutils literal notranslate"><span class="pre">io.get()</span></code> methods are deprecated and only
supported for backwards compatibility. Here is a translation of an old
authorization example into middleware-style.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">handshakeData</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// make sure the handshake data looks good</span><span class="w"></span>
<span class="w">  </span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// error first, &#39;authorized&#39; boolean second</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>vs.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">handshakeData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">request</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// make sure the handshake data looks good as before</span><span class="w"></span>
<span class="w">  </span><span class="c1">// if error do this:</span><span class="w"></span>
<span class="w">    </span><span class="c1">// next(new Error(&#39;not authorized&#39;));</span><span class="w"></span>
<span class="w">  </span><span class="c1">// else just call next</span><span class="w"></span>
<span class="w">  </span><span class="nx">next</span><span class="p">();</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="namespace-authorization">
<h3>Namespace authorization?<a class="headerlink" href="#namespace-authorization" title="此标题的永久链接"></a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/namespace&#39;</span><span class="p">).</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">handshakeData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">request</span><span class="p">;</span><span class="w">   </span><span class="nx">next</span><span class="p">();</span><span class="w"></span>
<span class="p">});</span><span class="sb">``</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="log-differences">
<h2>Log differences<a class="headerlink" href="#log-differences" title="此标题的永久链接"></a></h2>
<section id="logging-is-now-based-on-debug">
<h3>Logging is now based on debug<a class="headerlink" href="#logging-is-now-based-on-debug" title="此标题的永久链接"></a></h3>
<p>To print all debug logging, set the environment variable DEBUG to *.
ie: <code class="docutils literal notranslate"><span class="pre">DEBUG=*</span> <span class="pre">node</span> <span class="pre">index.js</span></code></p>
<p>To print only socket.io related logging:
<code class="docutils literal notranslate"><span class="pre">DEBUG=socket.io:*</span> <span class="pre">node</span> <span class="pre">index.js</span></code>.</p>
<p>To print logging only from the socket object:
<code class="docutils literal notranslate"><span class="pre">DEBUG=socket.io:socket</span> <span class="pre">node</span> <span class="pre">index.js</span></code>.</p>
<p>This pattern should hopefully be making sense at this point. The names
of the files in socket.io/lib are equivalent to their debug names.</p>
<p>Debug also works in the browser; logs are persisted to localstorage.</p>
<p>To use: open the developer console and type
<code class="docutils literal notranslate"><span class="pre">localStorage.debug</span> <span class="pre">=</span> <span class="pre">'socket.io:*'</span></code> (or any debug level) and then
refresh the page. Everything is logged until you run
<code class="docutils literal notranslate"><span class="pre">localStorage.debug</span> <span class="pre">=</span> <span class="pre">''</span></code></p>
<p>See more at the debug documentation
<a class="reference external" href="https://www.npmjs.org/package/debug">here</a>.</p>
</section>
</section>
<section id="shortcuts">
<h2>Shortcuts<a class="headerlink" href="#shortcuts" title="此标题的永久链接"></a></h2>
<p>In general there are some new shortcuts for common things. The old
versions should still work, but shortcuts are nice.</p>
<section id="broadcasting-to-all-clients-in-default-namespace">
<h3>Broadcasting to all clients in default namespace<a class="headerlink" href="#broadcasting-to-all-clients-in-default-namespace" title="此标题的永久链接"></a></h3>
<p>Previously:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;eventname&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;eventdata&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Now:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;eventname&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;eventdata&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Neat. Note that in both cases, these messages reach all clients
connected to the default ‘/’ namespace, but not clients in other
namespaces.</p>
</section>
<section id="starting-the-server">
<h3>Starting the server<a class="headerlink" href="#starting-the-server" title="此标题的永久链接"></a></h3>
<p>Previously:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* options */</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>Now:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">io</span><span class="p">({</span><span class="w"> </span><span class="cm">/* options */</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="configuration-differences">
<h2>Configuration differences<a class="headerlink" href="#configuration-differences" title="此标题的永久链接"></a></h2>
<section id="io-set-is-gone">
<h3>io.set is gone<a class="headerlink" href="#io-set-is-gone" title="此标题的永久链接"></a></h3>
<p>Instead do configuration in server initialization like this:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">)({</span><span class="w"></span>
<span class="w">  </span><span class="c1">// options go here</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>Options like log-level are gone. <code class="docutils literal notranslate"><span class="pre">io.set('transports')</span></code>,
<code class="docutils literal notranslate"><span class="pre">io.set('heartbeat</span> <span class="pre">interval')</span></code>, <code class="docutils literal notranslate"><span class="pre">io.set('heartbeat</span> <span class="pre">timeout'</span></code>, and
<code class="docutils literal notranslate"><span class="pre">io.set('resource')</span></code> are still supported for backwards compatibility.</p>
</section>
<section id="setting-resource-path">
<h3>Setting resource path<a class="headerlink" href="#setting-resource-path" title="此标题的永久链接"></a></h3>
<p>The previous <code class="docutils literal notranslate"><span class="pre">resource</span></code> option is equivalent to the new <code class="docutils literal notranslate"><span class="pre">path</span></code>
option, but needs a <code class="docutils literal notranslate"><span class="pre">/</span></code> in the beginning. For example, the following
configuration:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;localhost:3000&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="s1">&#39;resource&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;path/to/socket.io&#39;</span><span class="p">;</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;localhost:3000&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="s1">&#39;path&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/path/to/socket.io&#39;</span><span class="p">;</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="parser-protocol-differences">
<h2>Parser / Protocol differences<a class="headerlink" href="#parser-protocol-differences" title="此标题的永久链接"></a></h2>
<p>This is only relevant for updating things like socket.io implementations
in other languages, custom socket.io clients, etc.</p>
<section id="difference-1-packet-encoding">
<h3>Difference 1 – packet encoding<a class="headerlink" href="#difference-1-packet-encoding" title="此标题的永久链接"></a></h3>
<p>Parsing is now class based and asynchronous. Instead of returning a
single encoded string, encode calls callback with an array of encodings
as the only argument. Each encoding should be written to the transport
in order. This is more flexible and makes binary data transport work.
Here’s an example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">packet</span><span class="p">);</span><span class="w"></span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encoding</span><span class="p">);</span><span class="w"> </span><span class="c1">// fully encoded packet</span><span class="w"></span>
</pre></div>
</div>
<p>vs.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">Encoder</span><span class="p">();</span><span class="w"></span>
<span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">packet</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">encodings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="w"> </span><span class="nx">encodings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encodings</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span><span class="w"> </span><span class="c1">// encoded parts of the packet</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="difference-2-packet-decoding">
<h3>Difference 2 – packet decoding<a class="headerlink" href="#difference-2-packet-decoding" title="此标题的永久链接"></a></h3>
<p>Decoding takes things a step further and is event-based. This is done
because some objects (binary-containing) are both encoded and decoded in
multiple parts. This example should help:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">packet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">decoding</span><span class="p">);</span><span class="w"></span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">packet</span><span class="p">);</span><span class="w"> </span><span class="c1">// formed socket.io packet to handle</span><span class="w"></span>
</pre></div>
</div>
<p>vs.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">decoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">Decoder</span><span class="p">();</span><span class="w"></span>
<span class="nx">decoder</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;decoded&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">packet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">packet</span><span class="p">);</span><span class="w"> </span><span class="c1">// formed socket.io packet to handle</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
<span class="nx">decoder</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">encodings</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// say encodings is array of two encodings received from transport</span><span class="w"></span>
<span class="nx">decoder</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">encodings</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span><span class="w"> </span><span class="c1">// after adding the last element, &#39;decoded&#39; is emitted from decoder</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="rooms-and-namespaces.html" class="btn btn-neutral float-left" title="Rooms and namespaces" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="using-multiple-nodes.html" class="btn btn-neutral float-right" title="Using multiple nodes" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2019-2022, BandCap.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>